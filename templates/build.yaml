parameters:
  name: ""

jobs:
- job: build_${{ replace(parameters.name, '-', '_') }}
  displayName: Build, Pack and Test ${{ parameters.name }}
  variables:
    VERSION_NUMBER: 1.2.3
  steps:
  - task: gitversion/setup@0
    displayName: Install GitVersion
    inputs:
      versionSpec: '5.x'
  - task: gitversion/execute@0
    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
    inputs:
      useConfigFile: true
      configFilePath: '.gitversion.master.yml'
    displayName: Set version using gitversion for master branch
  - powershell: |
      Set-PSDebug -Trace 1
      $ver = "$(GitVersion.SemVer)"
      if ($ver -ne "") {
        $ver = "--version $ver"
      }
      cd ${{ parameters.name }}
      choco pack $ver
      cp *.nupkg $(Build.ArtifactStagingDirectory)/
      echo $(Build.ArtifactStagingDirectory)
      ls $(Build.ArtifactStagingDirectory)
    displayName: Run choco pack to build ${{ parameters.name }}
  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: '$(Build.ArtifactStagingDirectory)'
      artifactName: ${{ parameters.name }}
