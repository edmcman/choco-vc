parameters:
  name: ""

jobs:
- deployment: chocolateydeploy_${{ replace(parameters.name, '-', '_') }}
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/release'))
  displayName: Deploy ${{ parameters.name }} package to Chocolatey
  environment: chocolatey-publish-public
  strategy:
    runOnce:
      deploy:
        steps:
        - task: DownloadPipelineArtifact@2
          inputs:
            artifact: ${{ parameters.name }}
            path: $(Build.ArtifactStagingDirectory)
          displayName: 'Download nuget packages'

        - script: choco push $(Build.ArtifactStagingDirectory)\*.nupkg --source https://push.chocolatey.org/ --apikey %apikey%
          displayName: 'Uploading chocolatey package'
          env:
            apikey: $(chocolate-api-key)

